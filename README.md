Overview
-------------------------------------
This repository contains a script (network_visualization.py) that generates a network 
representation of the Cas9 protein (4008_network.pdf) when bound to a single guide RNA 
(sgRNA) and its target DNA. The structural information is derived from a pdb file 
(4oo8.pdb) that details a crystal structure reported in:

Nishimasu, H., Ran, F. A., Hsu, P. D., Konermann, S., Shehata, S. I., Dohmae, N., Ishitani, 
R., Zhang, F., & Nureki, O. (2014). Crystal structure of Cas9 in complex with guide RNA and 
target DNA. Cell, 156(5), 935â€“949.

The analysis is inspired by the work of Gaiha et al (citation below), who generated a method
for representing a protein as nodes and edges, where the individual amino acid residues are 
represented by nodes, and residue interactions are represented by edges. These interactions
are the summation of an "energetic" network and a "centroid" network. The energetic network
is the non-covalent interactions between all the residues, and the centroid network is the
interactions driven by hydrophobic packing (where closer residues are considered to be more
packed). 

Gaiha, G. D., Rossin, E. J., Urbach, J., Landeros, C., Collins, D. R., Nwonu, C., ... 
& Walker, B. D. (2019). Structural topology defines protective CD8+ T cell epitopes in the 
HIV proteome. Science, 364(6439), 480-484.

network_visualization.py is a script that takes the 4008.pdb file and outputs all the Cas9
residues, the sgRNA, and the target DNA as nodes in a network. Then, it calculcates the 
centroid network for the Cas9 residues and outputs it as edges in the network. The basis for 
the analytical methods comes from Nishimasu et al (cited above). 

Data
-------------------------------------
Purified Cas9-sgRNA-DNA complex was crystallized and analyzed via X-ray diffraction to 
resolve it. The protein structral data was downloaded directly from The Protein Database 
in .pdb format.

Folder Structure
-------------------------------------

data: Contains .csv file containing data describing the activity of a library of Cas9 mutants
generated by Spencer et al (citation below). Will be used partially for validation and partially
for training in future work on this project. 

Spencer, J. M., & Zhang, X. (2017). Deep mutational scanning of S. pyogenes Cas9 reveals important 
functional domains. Scientific reports, 7(1), 1-14.

figures: Contains surface and cartoon representations of Cas9-sgRNA-DNA complex (from Nishimasu et 
al), along with network representation generated by code. Color code for surface and cartoon 
representations:
- Blue - RuvC domain
- Green - Bridge helix
- Light gray - REC1
- Dark gray - REC2
- Pink - HNH domain
- Orange - PAM interacting domain
- Red - sgRNA
- Yellow - Target DNA

pdb: Contains pdb file analyzed (4oo8.pdb)
src: Contains source code for project (currently just network_visualization.py)


Installation
-------------------------------------

To run the code, the user needs to have an IDE that can run python scripts. The
user also must also have 4008.pdb in the same folder as the python script.

The packages necessary are:
Bio version 1.3.3
ipython version 8.1.1
matplotlib version 3.5.1
networkx version 2.6.3
numpy version 1.21.2

Network Analysis 
-------------------------------------
# INSTRUCTIONS FOR RUNNING THE NETWORK ANALYSIS PIPELINE

E. coli TEM1 beta-lactamase (1BTL.pdb) will be used for the purposes of this tutorial.


## I. Initialize directory structure.

	1. Create a directory in your chosen location called "NetworkAnalysis".

	> mkdir NetworkAnalysis
	> cd NetworkAnalysis

	2. Populate this directory with the dependencies provided in this Git repo. You will need:
		- 1BTL.pdb (a sample PDB file - replace this with your own)
		- AAarea
		- allatoms_radii
		- atomicWeights
		- buildEdges.sh
		- calculateFinalScore.R
		- makeWaterBonds.py
		- modularity_analysis_centroid.R
		- modularity_analysis_energetics.R
		- pdb2edgeSC.py
		- pdb2polypeptide.py
		- terminalAtoms
		- uniqueAtoms

	3. For each structure you'd like to analyze, create a new subdirectory named for the PBD code, and include the relevant PDB file within that directory (here we've provided 1BTL by way of example). 

	> mkdir 1BTL
	> mv 1BTL.pdb 1BTL
	
## II. Install dependencies.

	1. Download PHENIX (Python-based Hierarchical ENvironment for Integrated Xtallography) for protonation.
		- Download binaries from https://www.phenix-online.org/download/ (after requesting a password via email).
		- Follow installation instructions and note the final location; if you are using a Mac, it will likely be installed in your Applications directory. 
		- Make sure that line 18 in the file buildEdges.sh reflects this path. 

	2. Download STRIDE for secondary structure assignment.
		- Download binaries from http://webclu.bio.wzw.tum.de/stride/install.html
		- Create a directory called "Stride" one level above your NetworkAnalysis folder and copy any Stride-related files into this directory.

## III. Build the network.

	1. Run the buildEdges.sh script from within the NetworkAnalysis folder.

	> sh buildEdges.sh 1BTL/1BTL.pdb

	2. You will now see a number of files within the 1BTL/ directory, which correspond to the intermediate and final network files. The final file to be analyzed is 1BTL_net.

## IV. Analyze the network.

There are 3 steps to analyzing the network: the energetics analysis, the centroid analysis, and the final analysis. Note that most of the analysis (energetics and centroid) is already conducted by buildEdges.sh. The final analysis needs to be run separately using the calculateFinalScore.R script. Run this from within the 1BTL/ directory, with the following usage:

	> cd 1BTL
    > R --vanilla --args 1BTL/1BTL/ < ../calculateFinalScore.R 

The output is named "FinalSum" and is a list of nodes (amino acids) with their scores as follows:

> head FinalSum

- GLY156	-1.12139304234615
- HIS158	-1.64504045031281
- ALA150	-1.9452762424746
- GLU147	-1.52075794536626
- LEU139	1.15367020700574
- LEU162	2.19848342502133
- ALA280	-0.961502115446914
- ILE279	-0.00840942137073508
- ARG164	1.77030331167432
- GLU171	-0.735560986652963

These are the final network scores.

**_(NB: The placement of hydrogens, as determined by the phenix.reduce algorithm is not entirely deterministic: reasons for this are described in Word, et al.(1999) "Asparagine and glutamine: using hydrogen atom contacts in the choice of sidechain amide orientation" J. Mol. Biol. 285, 1735-1747. This accounts for minor (not functionally relevant) discrepancies between the network scores calculated by individual runs of this pipeline.)_**

For questions related to the network analysis code, contact Elizabeth_Rossin@MEEI.HARVARD.EDU.

